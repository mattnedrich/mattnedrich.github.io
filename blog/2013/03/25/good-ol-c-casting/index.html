<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Good ol' C Casting - Matt Nedrich</title>
  <meta name="author" content="Matt Nedrich">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mattnedrich.github.io/blog/2013/03/25/good-ol-c-casting">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Matt Nedrich" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Matt Nedrich</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
				<li >
                    <a href="/projects.html">Projects</a>
                </li>
				<li >
                    <a href="/about.html">About</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:mattnedrich.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-03-25T21:28:00-04:00" pubdate data-updated="true">Mar 25<span>th</span>, 2013</time>
        
      </p>
    
    
    <h1 class="entry-title">
        Good Ol' C Casting
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>Understanding data representation is important. Consider the following C code.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="predefined-type">float</span> foo = <span class="integer">5</span>;
<span class="predefined-type">int</span> bar = foo;
printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%d</span><span class="delimiter">&quot;</span></span>, bar);
</pre></div>
</div>
 </figure></notextile></div>

<p>This little C snippet outputs the number 5, as is expected. Now, let&rsquo;s make a slight change. Instead of assigning foo to bar, lets cast it to an int by casting the address that foo is stored to an int pointer and then dereferencing it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="predefined-type">float</span> foo = <span class="integer">5</span>;
<span class="predefined-type">int</span> bar = *(<span class="predefined-type">int</span>*)&amp;foo;
printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%d</span><span class="delimiter">&quot;</span></span>, bar);
</pre></div>
</div>
 </figure></notextile></div>

<p>This time around we get the value 1084227584. That&rsquo;s certainly not 5 (as we observed the first time around), so what&rsquo;s going on here. As you may have guessed, integer and floating point numbers are stored differently.</p>

<h2 id="dissecting-floating-point-numbers">Dissecting floating point numbers</h2>
<p>Let&rsquo;s start with how the float value is stored in memory. Wikipedia gives us this handly IEE 754 single precision binary floating point representation diagram:</p>

<p><img width="500px" src="/images/c_casting/500px-Float_example.svg.png" /></p>

<p>The most significant bit denotes the sign of the number. The next 8 bits store what&rsquo;s called the exponent. Finally the last 23 bits store the fraction, also known as the mantissa. When determining the value stored in such a floating point number, the following approach is used.</p>

<script type="math/tex; mode=display">value = (1.0+fraction)\cdot 2^{(exponent-127)}</script>

<p>In our example we were storing the value 5. This can be computed as <script type="math/tex">1.25\cdot 2^2</script>. As a 32-bit floating point number this is stored as </p>

<p><script type="math/tex">{01000000101000000000000000000000}_2</script>. </p>

<p>We can partition this binary number into the three different segments defined in the above diagram:</p>

<p><script type="math/tex">\color{blue}0\color{green}{10000001}\color{red}{01000000000000000000000}_2</script>. </p>

<p>If we look at these numbers individually we see that the sign bit <script type="math/tex">\color{blue}{0}_2</script> tells us the number is positive. The exponent <script type="math/tex">\color{green}{100000001}_2</script> is equal to <script type="math/tex">129-127=2</script> in decimal. Finally the fraction <script type="math/tex">\color{red}{01000000000000000000000}_2</script> gives us <script type="math/tex">2^{-2} = 0.25</script>. </p>

<p>If we put these three peices together we see that they give us the number <script type="math/tex">5</script>, as </p>

<p><script type="math/tex">(1.0+fraction)\cdot 2^{(exponent-127)} = 1.25\cdot 2^2 = 5</script>.</p>

<h2 id="conclusion">Conclusion</h2>
<p>In the first snippet when we assigned foo to bar an implicit floating point to two&rsquo;s complement conversion happened. The result of this converion was then stored in bar&rsquo;s memory location. In the second snippet we cast foo to an integer and the bits that make up foo were copied verbatim and stored as bar. Because no conversion occured we ended up with a different result.</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Matt Nedrich</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-03-25T21:28:00-04:00" pubdate data-updated="true">Mar 25<span>th</span>, 2013</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/c/'>C</a>, <a class='category' href='/blog/categories/floating-point/'>Floating Point</a>, <a class='category' href='/blog/categories/type-conversion/'>Type Conversion</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mattnedrich.github.io/blog/2013/03/25/good-ol-c-casting/" data-via="" data-counturl="http://mattnedrich.github.io/blog/2013/03/25/good-ol-c-casting/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2013/03/03/points-lines-and-calculus/" title="Previous Post: Points, Lines, and Calculus">&laquo; Points, Lines, and Calculus</a></li>
            
            
            <li class="next"><a href="/blog/2014/01/18/finding-files-on-windows/" title="Next Post: Finding Files on Windows">Finding Files on Windows &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2014/02/09/k-means-implementation-in-python/">K-Means in Python</a>
    
    <a class="list-group-item " href="/blog/2014/02/07/benchmarking-c-number/">Benchmarking C# Code</a>
    
    <a class="list-group-item " href="/blog/2014/02/01/android-virtual-machine-acceleration/">Android Virtual Machine Acceleration</a>
    
    <a class="list-group-item " href="/blog/2014/01/26/k-means-basics/">K-Means Clustering</a>
    
    <a class="list-group-item " href="/blog/2014/01/18/latex-math-in-octopress/">LaTeX Math in Octopress</a>
    
  </div>
</section>
<section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>






    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Matt Nedrich<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>








  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
